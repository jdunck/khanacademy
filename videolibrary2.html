{% extends "page_template.html" %}
{% block pagescript %}
<link type="text/css" href="/stylesheets/custom-theme/jquery-ui-1.8.4.custom.css" rel="stylesheet" />
<script src="javascript/jstree/jquery.jstree.js?{{App.version}}"></script>
<style>
    #overview {
        padding: 1ex 1em 1ex 1em;
        display: block;
    }
    
    #overview #overview_video, #overview #overview_video embed {
        float: left;
        width: 320;
        height: 205;
        padding: 1ex;
    }
    #search_and_browse {
        float: left;
        clear: none;
        width: auto;
        padding: 1ex 1em 1ex 1em;
        border: none;
    }
    #video_library_toc > ul {
        margin-left: 0;
        padding-left: 0;
    }
    #video_library_toc ul {
        margin-left: 0;
        padding-left: 1em;
    }
    #video_library_toc a:link, #video_library_toc a:visited {
        color:#006699;
        text-decoration: underline;
    }
    nav#video_library_toc li:before {
        content: "";
    }
    
    #video_library {
        clear: both;
        margin: 1em;
    }
    #video_library section {
        padding-left: 0em;
    }
    #video_library section h1 {
        font-size: larger;
    }
    #video_library .subtopics {
        border-left: solid 1px black;
        padding-left: 0em;
        margin-left: 1em;
        clear: left;
    }
    #video_library .subtopics h1 {
        padding-left: 1ex;
    }
    #video_library .subtopics h1 {
        display: block;
        float: left;
        margin-right: auto;
        margin-left: 0;
        padding-bottom: 0;
        margin-bottom: 0;
        border-top: solid 1px black;
    }
    #video_library .subtopics p, #video_library .subtopics .playlist_container {
        clear: left;
        margin-left: 0;
        padding-left: 1em;
    }
    #video_library .subtopics {
        *padding-top: 1em; /* Reasonable spacing in IE7 */
        *margin-bottom: 1em; /* Reasonable spacing in IE7 */
    }
    #video_library .subtopics .playlist_container {
        *margin-bottom: 1em; /* Reasonable spacing in IE7 */
    }
    #video_library ol li {
        display: inline-block;
        width: 25ex;
        vertical-align: top;
        padding: .5ex 2ex 0ex 0ex;
        border-top: dotted 1px #ccc;
        zoom:1; /* For inline-block in IE7 */
        *display: inline; /* For inline-block in IE7 */
        _height: 1em; /* For inline-block in IE6 */
    }
    
    #video_library ol li:before {
        content: counter(video) ". ";
        counter-increment: video;
    }
    
    #video_library ol {
        counter-reset: video;
        padding: 0ex 0em 0ex 0em;
        display: inline;
        *margin-left: 0; /* Prevents indenting first line in IE7 */
    }
    
    section.not_found {
        display: none !important;
    }    

    li.not_found {
        width: 0 !important;
        padding: 0 !important;
        margin: 0 !important;     
    }

    li.not_found a {
        display: none !important;        
    }

    #video_library ol li.not_found:before {
        content: "" !important;
    }
    
    .search_highlight a {
        background-color: yellow;
    }
    
</style>
<script>
    $(function() {
        $('#video_library_toc')
            .bind('loaded.jstree', function (event, data) {
                data.inst.open_all();

                $('#video_library_toc > ul > li > ul > li').each(function() {
                    data.inst.close_node(this);
                });
            })
            .jstree({
                core : {
                    html_titles : true
                },
                themes: {
                    theme: 'classic',
                    icons: false
                },
                plugins: ['html_data', 'themes']
            });
        $('#search_string').keypress(function(e) {
            if (e.which == 13) search();
        });
        $('#search_button').click(search);
        
        function search() {
            var s = $('#search_string').val();
            $('.search_highlight').removeClass('search_highlight');
            if (s.length > 0) {
                // Construct a RegExp that will match strings containing words begininning with
                // the search string (case-insensitive)
                var escapedSearchString = s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")
                var re = new RegExp("\\b"+escapedSearchString, "i");
                
                // Hide all the sections and videos initially
                $('#video_library section, #video_library li').addClass('not_found');
                
                // Highlight the videos whose title or keywords match the RegExp, and stop hiding
                // those videos and their containing sections
                $('#video_library li')
                    .filter(function() {return re.test($(this).text()) || re.test($(this).attr('data-keywords'));})
                    .addClass('search_highlight')
                    .parents().andSelf().removeClass('not_found');
                    
                // Set the focus to the first matching video
                $('#video_library .search_highlight a').first().focus();
            }
            else {
                $('#video_library *').removeClass('not_found');                
            }
        }
    });
</script>
{% endblock pagescript %}
{% block pagetitle %}{% endblock pagetitle %}
{% block pagecontent %}
<div id="search_and_browse">    
<p>
    <label>Keyword: <input id="search_string" type="text"></input></label>
    <button id="search_button" type="button">Search</button>
</p>      
<nav id="video_library_toc">
    <ul>
        {% for node in toc %}
        <li>
        {{ node }}
        </li>
        {% endfor %}
    </ul>
</nav>
</div>
<article id="overview">
    <p>
        The Khan Academy is a not-for-profit 501(c)(3) with the mission of providing a world-class education to anyone, anywhere.&nbsp;
        <object id="overview_video">
            <param name="movie" value="http://www.youtube.com/v/dsFQ9kM1qDs&hl=en_US&fs=1&hd=1">
            </param><param name="allowFullScreen" value="true">
            </param><param name="allowscriptaccess" value="always">
            </param>
            <embed src="http://www.youtube.com/v/dsFQ9kM1qDs&hl=en_US&fs=1&hd=1" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true">
            </embed>
        </object>
        Despite being the work of one man, Salman Khan, this 1600+ video library is the most-used educational video resource as measured 
        by YouTube video views per day and unique users per month.&nbsp;  We are complementing this ever-growing library with user-paced
        exercises--developed as an <A href="http://code.google.com/p/khanacademy/">open source project</A>--allowing the Khan Academy to
        become the free classroom for the World.&nbsp; <A href="/frequently-asked-questions"><b>Learn more about the Khan Academy and Salman Khan...</b></A>
    </p>
</article>
<article id="video_library">
    {% for node in contents %}
    {{ node }}
    {% endfor %}
</article>
{% endblock pagecontent %}