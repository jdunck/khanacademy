{% extends "page_template.html" %}
{% block pagescript %}
<style type="text/css">
#page_sub_nav b { display: none; }
</style>
<script type="text/javascript">
    $(function() {
        $("#reports-jump-menu #page-changer #submit").hide();
        $("#reports-jump-menu #page-changer select").val("classreport");
        $("#reports-jump-menu #page-changer select").change( function() {
            window.location = $("#reports-jump-menu #page-changer select option:selected").val() + "?coach={{coach_email|escapejs}}";
        });
    }
    );
</script>
{% endblock pagescript %}
{% block pagetitle %}Class Report{% endblock pagetitle %}
{% block pagecontent %}
<div id="report-page-content">
    <div id="reports-nav">
        <div id="reports-jump-menu">
            <label>View Report:</label>
            <form id="page-changer" action="" method="post">
                <select class="report-select">
                    <option value="classreport" selected="true">Student Progress Report</option>
                    <option value="classtime">Daily Activity Report</option>
                    <option value="sharedpoints">Class Energy Points per Minute</option>
                </select>
                <input type="submit" value="Go" id="submit" />
            </form>
        </div>
        <h3>Class Reports</h3>
    </div>
    <h4>Student Progress Report</h4>
    {% if students %}
    <p>
        Click on a cell in the table below to see charts of the student's progress in the exercise. Green means the student is proficient, blue means they are working on it,
        and red means they need help (they've done a lot of problems without getting a streak of correct answers).
    </p>
    
    <table id="module-progress">
        <tr>
            {% for exercise in exercises %}
                {% if forloop.first %}
                    <th id="students-header">Students</th>
                {% endif %}
                {% for student_email in exercise_data|hash:exercise %}
                    {% if forloop.first %}
                        <th><div>{{ exercise_data|hash:exercise|hash:student_email|hash:"exercise_display"|escape }}</div></th>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </tr>
        {% for student_email in students %}
            <tr>
            {% for exercise in exercises %}            
                {% if forloop.first %}
                    <td class="student-email">
                        <a style="color:#006699;" href="/progresschart?student_email={{ student_email|escape }};">
                            <nobr>{{ exercise_data|hash:exercise|hash:student_email|hash:"short_name"|escape }}</nobr>
                        </a>
                    </td>
                    <td class="student-module-status {{ exercise_data|hash:exercise|hash:student_email|hash:"color"|escapejs }}" onclick="location.href='{{ exercise_data|hash:exercise|hash:student_email|hash:"link"|escapejs }}'">
                        <div class="exercise-info-hover" style="display: none;" onclick="location.href='{{ exercise_data|hash:exercise|hash:student_email|hash:"link"|escapejs }}'">{{ exercise_data|hash:exercise|hash:student_email|hash:"hover" }}</div>
                    </td>
                {% else %}
                    <td class="student-module-status {{ exercise_data|hash:exercise|hash:student_email|hash:"color"|escapejs }}" onclick="location.href='{{ exercise_data|hash:exercise|hash:student_email|hash:"link"|escapejs }}'">
                        <div class="exercise-info-hover" style="display: none;" onclick="location.href='{{ exercise_data|hash:exercise|hash:student_email|hash:"link"|escapejs }}'">{{ exercise_data|hash:exercise|hash:student_email|hash:"hover" }}</div>
                    </td>
                {% endif %}
    		{% endfor %}
    		</tr>
        {% endfor %}
    </table>
    <script type="text/javascript">
    $(document).mousemove(function(e){window.mouseX = e.pageX; window.mouseY = e.pageY;});
    $("#module-progress td.student-module-status").hover( 
        function(e){
            var dtLastHover = window.dtLastHover = new Date();
            var self = this;
            setTimeout(function(){
                if (dtLastHover != window.dtLastHover) return;
            
                var infoHover = $(self).children(".exercise-info-hover");
                if ( !infoHover.is(":empty") ) {
                    infoHover.css('left', window.mouseX + 15);
                    infoHover.css('top', window.mouseY);
                    infoHover.css('cursor', 'pointer');
                    infoHover.show();
                }
            }, 100);
        },
        function(e){ 
            window.dtLastHover = null;
            $(this).children(".exercise-info-hover").hide();
        }
    );
    </script>
    {% else %}
    <p>To enable viewing this class report, each of your students should log in and click on the <a href="coaches">Add a Coach</a>
    link here or on the bottom of the page.  You'll need to give them the coach id <b>{{coach_email|escape}}</b> to enter next to the "Register Coach" button.
    After they register your id, you'll be able to see their progress below, and via the <a href="/students">students</a> page.
    </p>
    {% endif %}
</div>
{% endblock pagecontent %}

